# 스토캐스틱(Stochastic)

출처: https://amatoroi.tistory.com/35

스토캐스틱(Stochastic) 말고도 다양한 **오실레이터(oscillator)**가 있다. 오실레이터가 익숙한 사람들은 보통 공대생일 텐데, 오실레이터란 표현을 주가 분석에서 쓰는 이유는 공대의 그것과 동일한 의미를 가지기 때문이다.

**오실레이터란 반복적이고 주기적인 신호를 생성하는 “진동자”**



주가는 투자의 심리적 요인으로 가만히 있질 못하고 오르내리는 성향이 있다. 그 성질이 크기도 하고 작은 경우도 있지만, 많은 투자자들은 소위 **“발라먹는다”**라며 올랐을 때 팔고 내려왔을 때 사서 이익을 극대화하기 위해 주가의 변동을 **측정**하려는 시도를 했다. 달리말하자면, 투자가 몰린 과매수 상태와 과매도 상태를 확인하기 위한 시도로 오실레이터가 등장하였다.

Stochastic Ocillator란 그 중 가장 빨리 태어난 측정방법 중 하나이다.
물론, 그렇다고 가장 잘 맞는다는 것은 아니다.

오실레이터가 하나가 아닌 이유는, 아직까지는 공식처럼 모든 종목에 대입되는 것이 아니기 때문에 측정 시도가 끊임이 없기 때문이다. 즉, 오실레이터만 믿고 맹목적으로 투자하는 사람은 없길 바란다.



## **Stochastic Ocillator**

스토캐스틱 오실레이터란, 최근 N일간의 종가 중 오늘 종가가 어느 위치에 있는지를 의미한다.
최저가라면 0 %를, 최고가라면 100 %를 의미한다.
수식으로 쓰자면, 스토캐스틱 N = %K = (오늘 종가 - N일 중 최저가) / (N일 중 최고가 - N일 중 최저가).

**%D** 라고도 표현하는 **Slow %K** 는 %K의 m일 간 이동평균임으로, 조금 늦게 반응하는 지표라고 보면 된다.



### Slow Stochastic Ocillator

실질적으로 사용되는 스토캐스틱 오실레이터로, 상술한 %D와 다르다.

상술한 %K와 %D가 너무 빨리 움직여서 실제 신호인지 단순한 이레귤러인지 알지 못해서, 더 느리게 반응하도록 각각의 %D와 %D에 t일 간의 이동평균을 더 한 값이다. 일반적으로는 바로 Slow Stochastic을 사용한다.

흔히 사용하는 값은, N = 15, m = 5, t = 3 이다. 물론, 어떤 값이 더 특정 시점에 특정 종목과 맞을 지는 각자가 판단할 일이다.



## **코드에의 적용**

``` python
def AddStochastic(priceData, period = 15, screen_window = 5, slow_window = 3):
    ndayhigh = priceData['High'].rolling(window = period, min_periods = 1).max()
    ndaylow  = priceData['Low'].rolling(window = period, min_periods = 1).min()
    fast_k   = (priceData['Close'] - ndaylow) / (ndayhigh - ndaylow) * 100
    fast_d   = fast_k.rolling(window = screen_window).mean()
    slow_k   = fast_k.rolling(window = slow_window).mean()
    slow_d   = fast_d.rolling(window = slow_window).mean()
    return priceData.assign(slow_k = slow_k, slow_d = slow_d).dropna().copy()
```

priceData는 일자별 Date(날짜)를 인덱스로 가지고 Open(시가), High(고가), Low(저가), Close(종가)의 컬럼을 가지는 pandas의 DataFrame이다.

2행: 최근 N 일간(rolling 함수와 period)의 최고가(max())를 구하고,
3행: 최근 N일간의 최저가(min())을 구한다.
4행: Fast %K 값을 스토캐스틱 정의에 따라 구하고,
5행: Fast %D, Fast %K의 m 일간(screen_window) 이동평균을 구한다.

6행과 7행은 위에서 구한 %K와 %D에 t일간(slow_window)의 이동평균을 더한 **슬로우 스토캐스틱 오실레이터**이다.

내가 짠 함수에서는 슬로우 스토캐스틱 오실레이터만 추가하여 반환함을 주의하자.



## **적용예**

전체코드는 아래와 같으며, 기초 데이터셋(csv 파일)은 첨부파일을 활용하였다. 코드에는 경로를 포함하였기에, 기초 데이터셋의 구조와 값을 알고싶다면 활용하기 바란다.

``` py
import plotly.graph_objects as go
import pandas as pd
 
# 앞서 작성한 사용자 함수
def AddStochastic(priceData, period = 15, screen_window = 5, slow_window = 3):
    ndayhigh = priceData['High'].rolling(window = period, min_periods = 1).max()
    ndaylow  = priceData['Low'].rolling(window = period, min_periods = 1).min()
    fast_k   = (priceData['Close'] - ndaylow) / (ndayhigh - ndaylow) * 100
    fast_d   = fast_k.rolling(window = screen_window).mean()
    slow_k   = fast_k.rolling(window = slow_window).mean()
    slow_d   = fast_d.rolling(window = slow_window).mean()
    return priceData.assign(slow_k = slow_k, slow_d = slow_d).dropna().copy()
 
# 데이터셋 불러오기
pdata = pd.read_csv('https://blog.kakaocdn.net/dn/blX7fr/btrvI3Zi255/BQn2ZUrdCff0gjuHkbppu0/stock_price.csv?attach=1&knm=tfile.csv')
 
# 스토캐스틱을 데이터셋에 추가하기, 위에서 작성한 사용자함수를 활용
pdata = AddStochastic(pdata, 15, 5, 3)
 
# plotly로 그리기
fig = go.Figure()
fig.add_trace(go.Scatter(x=pdata.index, y=pdata['slow_k'], name = 'Slow %K'))
fig.add_trace(go.Scatter(x=pdata.index, y=pdata['slow_d'], name = 'Slow %D'))
#fig.show()
```



**csv 파일 예**

```
000100,Open,High,Low,Close,Volume,외국인소진율
2021-03-09,57900,58283,55795,56178,384590,19.35
2021-03-10,56465,57326,56178,56752,205894,19.38
2021-03-11,56752,57900,56082,56944,276604,19.36
2021-03-12,57805,58570,57422,57614,186545,19.37
2021-03-15,58474,58666,57805,58092,200647,19.35
2021-03-16,58474,60676,58379,60198,340971,19.34
2021-03-17,60580,60963,59910,60676,265210,19.35
2021-03-18,61058,61058,59527,59623,249587,19.31
2021-03-19,59623,59719,58570,59049,174994,19.31
2021-03-22,59144,59432,58570,58858,143027,19.29
2021-03-23,58666,59623,58283,58379,195979,19.27
2021-03-24,58379,58953,57709,58379,130916,19.28
2021-03-25,58187,58666,57900,58188,144517,19.27
2021-03-26,58379,59049,58092,59049,159552,19.29
2021-03-29,59144,59240,58379,58571,159600,19.28
2021-03-30,58953,59336,58379,59049,137503,19.32
2021-03-31,59431,60676,59144,60293,384975,19.42
```



일반적으로 80% 20%선이 기준이 되며 80% 이상이라면 조정을 받아 내려올 가능성이 높고 20% 아래로 떨어진다면 다시 올라갈 가능성이 높다고 보는 지표이다

---

### 변호사가 유행시킨 단타전략, Stochastic(스토캐스틱)



출처: [변호사가 유행시킨 단타전략, Stochastic(스토캐스틱) (finterstella.com)](https://quant.finterstella.com/12)

펀드매니저나 애널리스트 같은 증권업계 전문가가 아닌 주식과 직접적인 관련이 없는 직업을 가진 사람이라도 투자의 세계에서 유명해진 사람이 많이 있다. 그 중에 한 명인 고승덕 변호사가 유행시킨 단타전략이 스토캐스틱이다. 고승덕 변호사는 그의 저서 ‘고변호사의 주식강의’ (고승덕, 2002)에서 스토캐스틱을 마법의 지표라고 소개하며 적극 홍보했다. 얼마나 좋은 지표이길래 그리 칭찬했는지 한번 알아보자.

------

스토캐스틱은 1950년대에 조지 래인(George Lane)이 알린 지표이다. 지표의 컨셉은 최근 N일간 주가 범위 중 현재 주가가 얼마나 높이 있는가 이다. 공식을 보면 컨셉이 바로 보인다.



![img](https://blog.kakaocdn.net/dn/cjIEEE/btqXrDObQuh/7p0cz9pGmUwUYEk56JSnw0/img.png)



8일간의 주가가 다음과 같고 3일짜리 스토캐스틱인 스토캐스틱3을 구해보자. 스토캐스틱을 계산할 때는 종가만을 이용하는 것이 아니라 시고저종 정보를 모두 이용해서 구한다. 주의해야 한다.

| **일자** | **시가** | **고가** | **저가** | **종가** | **최고가** | **최저가** | **스토캐스틱3** | **K** | **D** |
| -------- | -------- | -------- | -------- | -------- | ---------- | ---------- | --------------- | ----- | ----- |
| **1**    | 10       | 11       | 9        | 10       | 11         | 9          |                 |       |       |
| **2**    | 11       | 12       | 10       | 11       | 12         | 10         |                 |       |       |
| **3**    | 8        | 10       | 8        | 9        | 10         | 8          | 25.0            |       |       |
| **4**    | 10       | 13       | 10       | 12       | 13         | 10         | 80.0            |       |       |
| **5**    | 13       | 15       | 12       | 15       | 15         | 12         | 100.0           | 68.3  |       |
| **6**    | 13       | 20       | 13       | 17       | 20         | 13         | 70.0            | 83.3  |       |
| **7**    | 17       | 18       | 15       | 16       | 18         | 15         | 50.0            | 73.3  | 75.0  |
| **8**    | 15       | 16       | 13       | 14       | 16         | 13         | 14.3            | 44.8  | 67.1  |

(Step 1) 3일짜리 스토캐스틱을 구해야 하니 첫 이틀은 데이터가 부족해서 계산이 불가하고, 3일째부터 들어간다. 1일~3일 기간의 최고가는 $12, 최저가는 $8이고, 3일자 종가는 $9니까 스토캐스틱3=*(9-8)/**(12-8)**×100=*25  이다.

마지막 행의 5일자는 3일~5일 기간의 최고가 $15, 최저가 $8, 5일자 종가 $15 이므로, 스토캐스틱3=*(15-8)/**(15-8)**×100=*100  이다.

 

(Step 2) 이렇게 구한 스토캐스틱은 그날 주가의 수준은 잘 보여주지만 들쭉날쭉이 심해 트레이딩에 이용하기엔 불편하다. 그래서 스토캐스틱 값의 이동평균을 구해 스무딩 해야한다. 이렇게 구한 이동평균값을 Slow K라고 부르고, Slow K가 트레이딩 지표로 사용한다.

 

(Step 3) 래인은 지표를 더 정교하게 만들고 싶었는지 Slow K를 한번 더 스무딩해서 Slow D를 만들었다. Slow D는 Slow K를 한번 더 이동평균을 구한 것이다. 그리고 Slow K와 Slow D의 차이도 트레이딩 지표로 함께 제시했다.

 

살펴본 바와 같이 스토캐스틱을 계산할 때는 3단계 기준이 필요하다. 최초 스토캐스틱을 구하는 기간 N, 스토캐스틱을 가지고 이동평균값을 계산해 Slow K를 구하는데 필요한 기간 m, Slow K에서 Slow D로 이동평균을 계산하는데 필요한 기간 t. 이를 간단히 STO(N, m, t)로 표시한다. 래인이 제시한 기본값은 STO(14, 3, 3) 이다. 거래하는 증권사에 따라 N, m, t 모두 설정할 수 있는 HTS도 있고, N만 설정할 수 있는 HTS도 있다.

