import pandas as pd
from support_resistance_line import SupportResistanceLine


def test():
    raw_data = [  # daily close of 000905.SH for 1 year from 20190901 to 20200901
        [5008.2958, 5044.1805, 5093.2662, 5138.4051, 5154.6378, 5263.4594, 5245.305],
        [5217.2913, 5242.6115, 5250.3398, 5140.4502, 5141.0381, 5191.6687, 5204.4848],
        [5171.484, 5180.7418, 5087.0091, 4970.2403, 5005.6299, 4940.903, 4941.7607],
        [4982.9535, 5046.3594, 5055.5165, 5131.1312, 5061.0029, 5038.356, 5029.854],
        [4961.8072, 4951.0354, 5005.5525, 4967.1949, 4958.2465, 4994.5684, 5084.4677],
        [5007.7126, 4947.8954, 4917.4174, 4962.3495, 4987.8364, 5025.3029, 4974.7343],
        [5007.0666, 4988.2938, 4876.1594, 4881.6144, 4875.543, 4912.1075, 4868.4367],
        [4892.4609, 4975.1128, 4946.2757, 4945.7188, 4904.0828, 4901.5021, 4882.1624],
        [4904.2568, 4889.2595, 4894.9416, 4905.4209, 4926.4548, 4920.6682, 4967.6021],
        [5010.5104, 5024.604, 5049.0514, 5027.2784, 5012.0011, 5073.6858, 5166.0391],
        [5236.0624, 5235.1248, 5241.7376, 5184.6752, 5084.3505, 5162.0702, 5183.0986],
        [5219.1404, 5179.1929, 5241.9383, 5267.6622, 5366.1375, 5380.6372, 5434.8503],
        [5499.8395, 5423.7966, 5497.5429, 5480.2279, 5559.6272, 5542.3316, 5530.0266],
        [5527.6676, 5510.0453, 5587.5359, 5523.9419, 5575.5126, 5377.7411, 4910.9011],
        [4996.4743, 5123.9619, 5282.8922, 5327.0369, 5388.4349, 5361.2768, 5459.9461],
        [5412.8418, 5420.8025, 5594.4366, 5660.8142, 5603.2626, 5706.7127, 5784.0321],
        [5865.4665, 5897.7219, 5743.3929, 5753.7277, 5451.2897, 5656.4193, 5710.0235],
        [5716.5112, 5801.1199, 5763.8602, 5525.8167, 5675.1113, 5589.5311, 5493.8838],
        [5457.2006, 5200.1142, 5212.0619, 5119.4716, 5157.8235, 5219.2809, 4998.9095],
        [5096.0408, 5217.4237, 5166.1091, 5137.3371, 5027.4856, 5041.4534, 5019.2187],
        [5147.2019, 5107.0393, 5267.073, 5271.7961, 5322.4614, 5208.5102, 5169.1757],
        [5288.593, 5268.7497, 5316.9707, 5318.4547, 5381.7857, 5343.8806, 5387.6233],
        [5357.7904, 5273.5474, 5265.7248, 5227.846, 5226.8116, 5353.8595, 5451.3159],
        [5445.7519, 5507.6965, 5496.192, 5512.464, 5536.2802, 5487.107, 5507.9336],
        [5478.8218, 5547.8759, 5489.7024, 5426.1745, 5328.2268, 5316.6036, 5420.2126],
        [5369.4992, 5361.167, 5406.3403, 5569.48, 5566.4438, 5572.3125, 5576.7535],
        [5585.4231, 5575.3036, 5610.3774, 5615.2417, 5589.1019, 5591.4871, 5590.6435],
        [5695.3007, 5735.4183, 5734.403, 5787.1482, 5784.0269, 5804.343, 5789.0893],
        [5762.4378, 5864.4164, 5881.8875, 5975.2794, 6051.5099, 6299.8551, 6380.0276],
        [6535.4151, 6693.7452, 6676.4373, 6899.5175, 6807.727, 6638.8384, 6319.9981],
        [6344.5912, 6526.8325, 6563.3239, 6620.6893, 6620.0859, 6283.9831, 6298.7351],
        [6359.6637, 6530.2712, 6511.436, 6579.6696, 6739.8085, 6697.7071, 6772.8422],
        [6770.3016, 6688.8822, 6725.2956, 6600.8472, 6528.3999, 6552.6567, 6623.5633],
        [6744.5468, 6789.3979, 6666.274, 6593.785, 6643.9444, 6688.9647, 6652.5478],
        [6525.8786, 6578.7912, 6691.2096, 6668.4331, 6710.4599],
    ]

    data_sr = pd.Series(sum(raw_data, []))  # transform to 1d series

    srl = SupportResistanceLine(data_sr)

    assert srl.best_line.slope == 16.2383375
    assert srl.best_line.intercept == 2661.154275
